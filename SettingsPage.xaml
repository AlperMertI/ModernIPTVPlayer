<Page
    x:Class="ModernIPTVPlayer.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid Padding="30">
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <Grid Padding="0,0,20,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- Title -->
                    <RowDefinition Height="Auto"/> <!-- Content -->
                </Grid.RowDefinitions>

                <TextBlock Text="Ayarlar" FontSize="32" FontWeight="Bold" Margin="0,0,0,20" Grid.ColumnSpan="3"/>

                <!-- LEFT COLUMN -->
                <StackPanel Grid.Row="1" Grid.Column="0" Spacing="20">
                    <!-- GENERAL SETTINGS GROUP -->
                    <StackPanel Spacing="10" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" Padding="20" CornerRadius="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <FontIcon Glyph="&#xE71D;" FontSize="20"/>
                            <TextBlock Text="Genel Ayarlar" FontSize="20" FontWeight="SemiBold"/>
                        </StackPanel>
                        <Border Height="1" Background="{ThemeResource CardStrokeColorDefaultBrush}" Margin="0,5,0,5"/>

                        <!-- Default Startup Page -->
                        <ComboBox x:Name="StartupPageCombo" Header="Açılış Sayfası" HorizontalAlignment="Stretch" SelectionChanged="StartupPageCombo_SelectionChanged">
                            <ComboBoxItem Content="Filmler (Stremio)" Tag="MoviesPage"/>
                            <ComboBoxItem Content="Diziler (Stremio)" Tag="SeriesPage"/>
                            <ComboBoxItem Content="Canlı TV (IPTV)" Tag="LiveTVPage"/>
                            <ComboBoxItem Content="Playlistlerim" Tag="LoginPage"/>
                        </ComboBox>
                        
                        <TextBlock Text="Uygulama açıldığında varsayılan olarak hangi ekranın gösterileceğini seçin."
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12" TextWrapping="Wrap"/>
                    </StackPanel>

                     <!-- CACHE SETTINGS GROUP -->
                    <StackPanel Spacing="10" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" Padding="20" CornerRadius="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <FontIcon Glyph="&#xE7F3;" FontSize="20"/>
                            <TextBlock Text="Önbellek &amp; Veri Yönetimi" FontSize="20" FontWeight="SemiBold"/>
                        </StackPanel>
                        <Border Height="1" Background="{ThemeResource CardStrokeColorDefaultBrush}" Margin="0,5,0,5"/>

                        <!-- Auto Update Toggle -->
                        <ToggleSwitch x:Name="AutoCacheToggle" Header="Otomatik Arka Plan Güncellemesi" 
                                      OnContent="Açık" OffContent="Kapalı" 
                                      IsOn="{x:Bind ViewModel.IsAutoCacheEnabled, Mode=TwoWay}"
                                      Toggled="AutoCacheToggle_Toggled"/>
                        
                        <TextBlock Text="Bu özellik açıksa, uygulama her 15 dakikada bir verilerinizi kontrol eder ve gerekirse arka planda günceller."
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12" TextWrapping="Wrap"/>

                        <!-- Update Interval -->
                        <ComboBox x:Name="IntervalCombo" Header="Güncelleme Kontrol Sıklığı" HorizontalAlignment="Stretch" SelectionChanged="IntervalCombo_SelectionChanged">
                            <ComboBoxItem Content="15 Dakika (Test)" Tag="15"/>
                            <ComboBoxItem Content="1 Saat" Tag="60"/>
                            <ComboBoxItem Content="6 Saat" Tag="360"/>
                            <ComboBoxItem Content="12 Saat" Tag="720"/>
                            <ComboBoxItem Content="24 Saat (Önerilen)" Tag="1440"/>
                        </ComboBox>

                        <!-- Actions -->
                        <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,15,0,0">
                            <Button x:Name="BtnClearCache" Click="BtnClearCache_Click">
                                <Button.Content>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <FontIcon Glyph="&#xE74D;"/>
                                        <TextBlock Text="Önbelleği Temizle"/>
                                    </StackPanel>
                                </Button.Content>
                            </Button>
                            
                            <Button x:Name="BtnRefreshNow" Style="{StaticResource AccentButtonStyle}" Click="BtnRefreshNow_Click">
                                 <Button.Content>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <FontIcon Glyph="&#xE72C;"/>
                                        <TextBlock Text="Şimdi Güncelle"/>
                                    </StackPanel>
                                </Button.Content>
                            </Button>
                        </StackPanel>

                        <TextBlock x:Name="TxtStatus" Text="Hazır" Margin="0,10,0,0" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    </StackPanel>

                    <!-- PROBE CACHE GROUP -->
                    <StackPanel Spacing="10" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" Padding="20" CornerRadius="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                         <StackPanel Orientation="Horizontal" Spacing="10">
                            <FontIcon Glyph="&#xE9D9;" FontSize="20"/>
                            <TextBlock Text="Akış Analiz Verileri (Probe)" FontSize="20" FontWeight="SemiBold"/>
                        </StackPanel>
                        <Border Height="1" Background="{ThemeResource CardStrokeColorDefaultBrush}" Margin="0,5,0,5"/>
                        
                        <TextBlock Text="Yayınların çözünürlük ve codec bilgileri daha hızlı açılış için cihazınızda saklanır."
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12" TextWrapping="Wrap" Margin="0,0,0,5"/>

                        <ToggleSwitch x:Name="AutoProbeToggle" Header="Otomatik Kanal Analizi" 
                                       OnContent="Açık" OffContent="Kapalı" 
                                       Toggled="AutoProbeToggle_Toggled"/>
                        
                        <TextBlock Text="Bu özellik açıksa, kanal listesinde gezerken yayınların kaliteleri arka planda otomatik olarak kontrol edilir."
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12" TextWrapping="Wrap" Margin="0,0,0,10"/>
                        
                         <Button Content="Analiz Verilerini Temizle" Click="BtnClearProbe_Click"/>
                    </StackPanel>
                </StackPanel>

                <!-- RIGHT COLUMN -->
                <StackPanel Grid.Row="1" Grid.Column="2" Spacing="20">
                    <!-- ADVANCED PLAYER SETTINGS GROUP -->
                    <StackPanel Spacing="10" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" Padding="20" CornerRadius="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <FontIcon Glyph="&#xE793;" FontSize="20"/>
                            <TextBlock Text="Gelişmiş Oynatıcı Ayarları" FontSize="20" FontWeight="SemiBold"/>
                        </StackPanel>
                        <Border Height="1" Background="{ThemeResource CardStrokeColorDefaultBrush}" Margin="0,5,0,5"/>

                        <!-- Profile Selection -->
                        <ComboBox x:Name="PlayerProfileCombo" Header="Performans Profili" HorizontalAlignment="Stretch" SelectionChanged="PlayerProfileCombo_SelectionChanged">
                            <ComboBoxItem Content="Performans (Düşük Gecikme)" Tag="Performance" ToolTipService.ToolTip="En hızlı çalışma modu. Eski cihazlar ve pilli kullanım için önerilir."/>
                            <ComboBoxItem Content="Dengeli (Önerilen)" Tag="Balanced" ToolTipService.ToolTip="Görüntü kalitesi ve performans arasında en iyi denge."/>
                            <ComboBoxItem Content="Yüksek Kalite (High Quality)" Tag="HighQuality" ToolTipService.ToolTip="En iyi görüntü kalitesi. Güçlü bir ekran kartı gerektirir."/>
                            <ComboBoxItem Content="Özel (Custom)" Tag="Custom" ToolTipService.ToolTip="Ayarları kendiniz yapılandırın."/>
                        </ComboBox>
                        <TextBlock x:Name="ProfileDescriptionText" Text="Seçilen profile göre ayarlar otomatik yapılandırılır." 
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12" TextWrapping="Wrap" Margin="0,-5,0,5"/>

                        <!-- Hardware Decoding -->
                        <ComboBox x:Name="HwDecCombo" Header="Donanım Hızlandırma" HorizontalAlignment="Stretch" SelectionChanged="PlayerSetting_Changed">
                            <ComboBoxItem Content="Otomatik (Safe)" Tag="AutoSafe" ToolTipService.ToolTip="En uyumlu donanım hızlandırma yöntemini seçer (DXVA2/D3D11)."/>
                            <ComboBoxItem Content="Otomatik (Copy)" Tag="AutoCopy" ToolTipService.ToolTip="Video belleğini RAM'e kopyalar. Yazılımsal filtreler için gereklidir ama daha yavaştır."/>
                            <ComboBoxItem Content="Kapalı (Yazılım)" Tag="No" ToolTipService.ToolTip="İşlemciyi (CPU) kullanır. Pil ömrünü azaltabilir."/>
                        </ComboBox>

                        <!-- Video Output -->
                        <ComboBox x:Name="VoCombo" Header="Görüntü Motoru (VO)" HorizontalAlignment="Stretch" SelectionChanged="PlayerSetting_Changed">
                            <ComboBoxItem Content="GPU-Next (Modern)" Tag="GpuNext" ToolTipService.ToolTip="Yeni nesil render motoru. HDR ve Dolby Vision için gereklidir."/>
                            <ComboBoxItem Content="GPU (Klasik)" Tag="Gpu" ToolTipService.ToolTip="Eski render motoru. Sadece uyumluluk sorunu yaşarsanız seçin."/>
                        </ComboBox>

                        <!-- Scaler -->
                        <ComboBox x:Name="ScalerCombo" Header="Upscaling (Ölçekleme)" HorizontalAlignment="Stretch" SelectionChanged="PlayerSetting_Changed">
                            <ComboBoxItem Content="Bilinear (Hızlı)" Tag="Bilinear" ToolTipService.ToolTip="En az kaynak tüketen yöntem. Görüntü biraz yumuşak olabilir."/>
                            <ComboBoxItem Content="Spline36 (Dengeli)" Tag="Spline36" ToolTipService.ToolTip="Keskinlik ve performans dengesi. Varsayılan."/>
                            <ComboBoxItem Content="EWA Lanczos (Keskin)" Tag="EwaLanczos" ToolTipService.ToolTip="Yüksek kaliteli ve keskin görüntü. Güçlü GPU gerektirir."/>
                        </ComboBox>

                        <!-- Tone Mapping -->
                        <ComboBox x:Name="ToneMappingCombo" Header="HDR Ton Eşleme" HorizontalAlignment="Stretch" SelectionChanged="PlayerSetting_Changed">
                            <ComboBoxItem Content="Otomatik" Tag="Auto" ToolTipService.ToolTip="MPV en uygun yöntemi seçer."/>
                            <ComboBoxItem Content="Spline (Standart)" Tag="Spline" ToolTipService.ToolTip="Standart parlaklık dengelemesi."/>
                            <ComboBoxItem Content="BT.2446a (Modern)" Tag="Bt2446a" ToolTipService.ToolTip="Gelişmiş renk koruması sağlayan modern standart."/>
                            <ComboBoxItem Content="ST.2094-40 (Uzman)" Tag="St2094_40" ToolTipService.ToolTip="Dinamik metadata üretir. En iyi HDR->SDR dönüşümü sağlar ama çok kaynak tüketir."/>
                            <ComboBoxItem Content="Clip (Kırpma)" Tag="Clip" ToolTipService.ToolTip="Parlak alanları kırparak detay kaybına yol açabilir."/>
                        </ComboBox>

                        <!-- Target Display Mode -->
                        <ComboBox x:Name="TargetModeCombo" Header="HDR Hedef Modu" HorizontalAlignment="Stretch" SelectionChanged="PlayerSetting_Changed">
                            <ComboBoxItem Content="Otomatik (Önerilen)" Tag="Auto" ToolTipService.ToolTip="Windows HDR açıksa HDR sinyali gönderir, kapalıysa SDR'a dönüştürür."/>
                            <ComboBoxItem Content="SDR (Zorla)" Tag="SdrForce" ToolTipService.ToolTip="HDR içerikleri her zaman SDR renklere dönüştürür."/>
                            <ComboBoxItem Content="HDR (Passthrough)" Tag="HdrPassthrough" ToolTipService.ToolTip="Her zaman HDR sinyali gönderir. SDR içerikler soluk görünebilir!"/>
                        </ComboBox>

                        <!-- Target Peak -->
                        <ComboBox x:Name="TargetPeakCombo" Header="Hedef Parlaklık (Nits)" HorizontalAlignment="Stretch" SelectionChanged="PlayerSetting_Changed">
                            <ComboBoxItem Content="Otomatik" Tag="Auto"/>
                            <ComboBoxItem Content="SDR (100 nits)" Tag="Sdr100"/>
                            <ComboBoxItem Content="SDR Parlak (203 nits)" Tag="Sdr203"/>
                            <ComboBoxItem Content="HDR Düşük (400 nits)" Tag="Hdr400"/>
                            <ComboBoxItem Content="HDR Yüksek (1000 nits)" Tag="Hdr1000"/>
                        </ComboBox>

                        <!-- Audio Channels -->
                        <ComboBox x:Name="AudioChannelsCombo" Header="Ses Kanalları" HorizontalAlignment="Stretch" SelectionChanged="PlayerSetting_Changed">
                            <ComboBoxItem Content="Otomatik" Tag="AutoSafe" ToolTipService.ToolTip="Sistem yapılandırmasını algılar."/>
                            <ComboBoxItem Content="Stereo (2.0)" Tag="Stereo"/>
                            <ComboBoxItem Content="5.1 Surround" Tag="Surround51"/>
                            <ComboBoxItem Content="7.1 Surround" Tag="Surround71"/>
                        </ComboBox>

                        <!-- Toggles Grid -->
                        <Grid ColumnSpacing="10" Margin="0,5,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <ToggleSwitch x:Name="DebandToggle" Header="Deband (Renk Düzeltme)" 
                                          OnContent="Açık" OffContent="Kapalı"
                                          Toggled="PlayerSetting_Toggled" Grid.Column="0"
                                          ToolTipService.ToolTip="Renk geçişlerindeki bozulmaları (banding) düzeltir."/>

                            <ToggleSwitch x:Name="ExclusiveToggle" Header="Özel Ses Modu (Exclusive)" 
                                          OnContent="Açık" OffContent="Kapalı"
                                          Toggled="PlayerSetting_Toggled" Grid.Column="1"
                                          ToolTipService.ToolTip="Sesi diğer uygulamalara kapatarak en temiz ses çıkışını sağlar."/>
                        </Grid>

                        <!-- Raw Config Expander -->
                        <Expander Header="Gelişmiş MPV Yapılandırması" HorizontalAlignment="Stretch" Margin="0,10,0,0">
                            <StackPanel Spacing="10" Padding="0,10,0,0">
                                <TextBlock Text="Buraya MPV'nin desteklediği diğer parametreleri ekleyebilirsiniz. (örn: video-sync=display-resample)" 
                                           FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                                <TextBox x:Name="CustomConfigBox" AcceptsReturn="True" Height="100" 
                                         PlaceholderText="config-param=value&#x0a;config-param2=value"
                                         TextChanged="CustomConfigBox_TextChanged"/>
                            </StackPanel>
                        </Expander>
                    </StackPanel>

                     <!-- PLAYER BUFFER SETTINGS GROUP -->
                    <StackPanel Spacing="10" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" Padding="20" CornerRadius="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <FontIcon Glyph="&#xE768;" FontSize="20"/>
                            <TextBlock Text="Önbellek (Buffer) Stratejisi" FontSize="20" FontWeight="SemiBold"/>
                        </StackPanel>
                        <Border Height="1" Background="{ThemeResource CardStrokeColorDefaultBrush}" Margin="0,5,0,5"/>

                        <!-- Pre-buffer Toggle -->
                        <ToggleSwitch x:Name="PrebufferToggle" Header="Hızlı Başlat (Pre-buffer)" 
                                       OnContent="Açık" OffContent="Kapalı" 
                                       Toggled="PrebufferToggle_Toggled"/>
                        
                        <TextBlock Text="İçerik detay sayfasındayken videoyu arka planda yüklemeye başlar. Oynat dediğinizde bekleme süresini azaltır."
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12" TextWrapping="Wrap" Margin="0,0,0,5"/>
                        
                        <!-- Pre-buffer Slider -->
                        <Grid Margin="0,5,0,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Text="Hızlı Başlat Süresi (Saniye)" Margin="0,0,0,5"/>
                            <Slider x:Name="PrebufferSlider" Minimum="5" Maximum="60" StepFrequency="5" 
                                    TickFrequency="5" TickPlacement="Outside"
                                    Grid.Row="1" ValueChanged="PrebufferSlider_ValueChanged"/>
                        </Grid>

                         <!-- Main Buffer Slider -->
                         <Grid Margin="0,15,0,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Text="Oynatıcı Tampon Süresi (Saniye)" Margin="0,0,0,5"/>
                            <Slider x:Name="BufferSlider" Minimum="30" Maximum="300" StepFrequency="10" 
                                    TickFrequency="30" TickPlacement="Outside"
                                    Grid.Row="1" ValueChanged="BufferSlider_ValueChanged"/>
                            
                            <TextBlock Text="Oynatıcı açıldığında videonun ne kadar süre ileriye doğru yükleneceğini belirler. Yüksek değerler, yavaş internet bağlantılarında donmayı azaltabilir ancak RAM kullanımını artırır."
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12" TextWrapping="Wrap" Grid.Row="2" Margin="0,5,0,0"/>
                        </Grid>
                    </StackPanel>

                    <!-- METADATA SETTINGS GROUP -->
                    <StackPanel Spacing="10" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" Padding="20" CornerRadius="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <FontIcon Glyph="&#xE12B;" FontSize="20"/>
                            <TextBlock Text="Metadata &amp; İçerik" FontSize="20" FontWeight="SemiBold"/>
                        </StackPanel>
                        <Border Height="1" Background="{ThemeResource CardStrokeColorDefaultBrush}" Margin="0,5,0,5"/>

                        <TextBlock Text="TMDB API Anahtarı (Opsiyonel)" FontWeight="SemiBold"/>
                        <TextBlock Text="Türkçe içerik, yüksek kaliteli görseller ve detaylı bilgiler için kendi API anahtarınızı kullanın."
                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12" TextWrapping="Wrap"/>
                        
                        <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,5,0,0">
                            <PasswordBox x:Name="TmdbApiKeyBox" PlaceholderText="API Anahtarınızı buraya yapıştırın" Width="300"
                                         PasswordChanged="TmdbApiKeyBox_PasswordChanged"/>
                            <Button Content="Kaydet" Click="BtnSaveTmdb_Click"/>
                        </StackPanel>
                        <TextBlock x:Name="TmdbStatusText" Text="API Anahtarı girilmedi." Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="12" Margin="0,5,0,0"/>

                    </StackPanel>
                </StackPanel>
            </Grid>
        </ScrollViewer>

        <!-- Notification Area (for visual feedback) -->
        <InfoBar x:Name="StatusInfoBar" VerticalAlignment="Bottom" Margin="0,0,0,20" IsOpen="False"/>
    </Grid>
</Page>
