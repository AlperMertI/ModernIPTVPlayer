<Page
    x:Class="ModernIPTVPlayer.MediaInfoPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:ModernIPTVPlayer"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ctl="using:ModernIPTVPlayer.Controls"
    xmlns:controls="using:Microsoft.UI.Xaml.Controls"
    xmlns:mpv="using:MpvWinUI"
    xmlns:Media="using:Microsoft.UI.Xaml.Media"
    mc:Ignorable="d"
    Background="#0D0D0D">

    <Page.Resources>
        <SolidColorBrush x:Key="GlassBackgroundBrush" Color="#1A1A1A" Opacity="0.75"/>
        <Style x:Key="GlassButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource GlassBackgroundBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="24,12"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#33FFFFFF"/>
        </Style>
    </Page.Resources>

    <Grid x:Name="RootGrid">
        
        <!-- 1. FULLSCREEN HERO BACKGROUND -->
        <Grid x:Name="HeroContainer" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
            <Image x:Name="HeroImage" Stretch="UniformToFill" HorizontalAlignment="Center" VerticalAlignment="Center" Opacity="0.8"/>
            
            <!-- Dark Overlay for Readability -->
            <Rectangle VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
                <Rectangle.Fill>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Color="#00000000" Offset="0"/>
                        <GradientStop Color="#66000000" Offset="0.4"/>
                        <GradientStop Color="#FF0D0D0D" Offset="0.85"/>
                        <GradientStop Color="#FF0D0D0D" Offset="1"/>
                    </LinearGradientBrush>
                </Rectangle.Fill>
            </Rectangle>
        </Grid>

        <!-- 2. MAIN CONTENT (SCROLLABLE OVER HERO) -->
        <ScrollViewer x:Name="MainScrollViewer" VerticalScrollBarVisibility="Hidden" HorizontalScrollMode="Disabled">
            <StackPanel VerticalAlignment="Bottom" Padding="0,300,0,50">
                <!-- Info Section -->
                <Grid Padding="60,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/> <!-- Poster -->
                        <ColumnDefinition Width="*"/>    <!-- Text -->
                    </Grid.ColumnDefinitions>

                    <!-- Poster Card (Fixed Bottom Left) -->
                    <Grid x:Name="PosterContainer" Width="220" Height="330" VerticalAlignment="Bottom">
                        <ctl:PosterCard x:Name="MainPoster" Width="220" Height="330" IsTiltEnabled="False" />
                    </Grid>

                    <!-- Text Details -->
                    <StackPanel Grid.Column="1" Margin="40,0,0,10" VerticalAlignment="Bottom" Spacing="12">
                        <!-- Title -->
                        <TextBlock x:Name="TitleText" Text="Loading..." FontSize="56" FontWeight="Bold" 
                                   TextWrapping="Wrap" Foreground="White" CharacterSpacing="20">
                            <TextBlock.Shadow>
                                <ThemeShadow/>
                            </TextBlock.Shadow>
                        </TextBlock>

                        <!-- Meta Badges -->
                        <StackPanel Orientation="Horizontal" Spacing="16">
                            <Border Background="#E50914" CornerRadius="4" Padding="8,4" x:Name="MatchBadge">
                                <TextBlock x:Name="RatingText" Text="98% Match" FontWeight="Bold" FontSize="14" Foreground="White"/>
                            </Border>
                            <TextBlock x:Name="YearText" Text="2024" FontSize="16" Foreground="#DDDDDD" VerticalAlignment="Center"/>
                            <Border BorderBrush="#88FFFFFF" BorderThickness="1" CornerRadius="4" Padding="6,2">
                                <TextBlock Text="HD" FontSize="12" Foreground="#DDDDDD"/>
                            </Border>
                        </StackPanel>

                        <!-- Overview -->
                        <TextBlock x:Name="OverviewText" 
                                   Text="Description..." 
                                   FontSize="16" Foreground="#E0E0E0" 
                                   TextWrapping="Wrap" MaxLines="4" TextTrimming="CharacterEllipsis"
                                   MaxWidth="800" HorizontalAlignment="Left" LineHeight="26"/>
                                   
                        <!-- Action Buttons -->
                        <StackPanel Orientation="Horizontal" Spacing="20" Margin="0,20,0,0">
                            <Button x:Name="PlayButton" Click="PlayButton_Click" 
                                    Background="White" Foreground="Black" 
                                    CornerRadius="6" Padding="32,14" FontSize="18" FontWeight="Bold">
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <FontIcon Glyph="&#xE768;"/>
                                    <TextBlock x:Name="PlayButtonText" Text="Oynat"/>
                                </StackPanel>
                            </Button>

                            <Button x:Name="TrailerButton" Click="TrailerButton_Click" 
                                    Background="#44FFFFFF" Foreground="White"
                                    CornerRadius="6" Padding="24,14" FontSize="16" FontWeight="SemiBold">
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <FontIcon Glyph="&#xE714;" FontSize="18"/>
                                    <TextBlock Text="Fragman"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </StackPanel>
                </Grid>

                <!-- 3. EPISODES ROW (Series Only) -->
                <Grid x:Name="SeasonsContainer" Margin="0,60,0,0" Visibility="Collapsed">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <TextBlock Text="Bölümler" FontSize="24" FontWeight="Bold" Foreground="White" Margin="60,0,0,20"/>
                    
                    <ListView x:Name="EpisodesListView" Grid.Row="1" 
                              SelectionMode="Single"
                              SelectionChanged="EpisodesListView_SelectionChanged"
                              ScrollViewer.HorizontalScrollMode="Enabled"
                              ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                              ScrollViewer.VerticalScrollMode="Disabled"
                              Padding="60,0,60,30">
                        <ListView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="20"/>
                            </ItemsPanelTemplate>
                        </ListView.ItemsPanel>
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Width="260" Height="146" CornerRadius="8" Background="#33FFFFFF">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <Image Source="{Binding ImageUrl}" Stretch="UniformToFill" Opacity="0.9"/>
                                    
                                    <Grid Background="#44000000" VerticalAlignment="Bottom" Padding="10,6">
                                        <TextBlock Text="{Binding Title}" FontWeight="SemiBold" Foreground="White" FontSize="13" TextTrimming="CharacterEllipsis"/>
                                    </Grid>
                                    
                                    <!-- Hover/Play Icon could be added here -->
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Grid>
            </StackPanel>
        </ScrollViewer>

        <!-- 4. INSTANT PLAYER OVERLAY (FULLSCREEN) -->
        <!-- Placed LAST to cover everything when active -->
        <Grid x:Name="PlayerOverlayContainer" Visibility="Collapsed" Background="Black">
             <mpv:MpvPlayer x:Name="MediaInfoPlayer" 
                           Opacity="0"
                           IsHitTestVisible="False"
                           HorizontalAlignment="Stretch" 
                           VerticalAlignment="Stretch"/>
             
             <!-- Simple Custom Controls for Overlay Player -->
             <Button x:Name="ClosePlayerButton" Click="BackButton_Click" 
                     VerticalAlignment="Top" HorizontalAlignment="Left" Margin="40"
                     Background="#44000000" Foreground="White" CornerRadius="20" Padding="12">
                 <FontIcon Glyph="&#xE711;" FontSize="20"/>
             </Button>
        </Grid>

        <!-- Back Button (Main Page) -->
        <Button x:Name="BackButton" Click="BackButton_Click" 
                VerticalAlignment="Top" HorizontalAlignment="Left" Margin="40,40,0,0"
                Style="{StaticResource GlassButtonStyle}" Padding="12" CornerRadius="20">
            <FontIcon Glyph="&#xE72B;"/>
        </Button>

    </Grid>
</Page>
