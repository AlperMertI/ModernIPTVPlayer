<Page
    x:Class="ModernIPTVPlayer.Pages.AddonsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="using:ModernIPTVPlayer.Pages"
    xmlns:root="using:ModernIPTVPlayer"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
    
    <Page.Resources>
        <root:BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <root:BooleanInverseToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
    </Page.Resources>

    <Grid Padding="30">
        <Grid.RowDefinitions>
             <RowDefinition Height="Auto"/>
             <RowDefinition Height="Auto"/>
             <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <StackPanel Spacing="8">
            <TextBlock Text="Stremio Eklentileri" FontSize="32" FontWeight="Bold"/>
            <TextBlock Text="İçerik kaynaklarını yönetin. Eklentiler aracılığıyla kataloglara ve yayınlara erişebilirsiniz." 
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" FontSize="14"/>
        </StackPanel>
        
        <!-- Input Area -->
        <Grid Grid.Row="1" Margin="0,30,0,20">
             <Grid.ColumnDefinitions>
                 <ColumnDefinition Width="*"/>
                 <ColumnDefinition Width="Auto"/>
             </Grid.ColumnDefinitions>
             
             <TextBox x:Name="AddonUrlBox" PlaceholderText="Eklenti Bağlantısı (Manifest URL) - Örn: https://v3-cinemeta.strem.io/manifest.json" 
                      VerticalAlignment="Center" Margin="0,0,10,0"/>
             
             <Button x:Name="BtnInstall" Grid.Column="1" Click="BtnInstall_Click" Style="{StaticResource AccentButtonStyle}">
                 <StackPanel Orientation="Horizontal" Spacing="8">
                     <FontIcon Glyph="&#xE710;"/>
                     <TextBlock Text="Yükle"/>
                 </StackPanel>
             </Button>
        </Grid>
        
        <!-- Addon List -->
        <ListView x:Name="AddonListView" Grid.Row="2" 
                  SelectionMode="None"
                  CanReorderItems="True" 
                  AllowDrop="True" 
                  CanDragItems="True"
                  DragItemsCompleted="AddonListView_DragItemsCompleted">
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="local:AddonItem">
                    <Grid Padding="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" CornerRadius="8" Margin="0,0,0,10" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="60"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Drag Handle -->
                        <FontIcon Glyph="&#xE76C;" FontSize="14" Foreground="{ThemeResource TextFillColorSecondaryBrush}" VerticalAlignment="Center" Margin="0,0,12,0" Opacity="0.5"/>
                        
                        <!-- Icon -->
                        <Border Grid.Column="1" Width="48" Height="48" CornerRadius="8" Background="Transparent">
                            <Grid>
                                <FontIcon Glyph="&#xE74C;" FontSize="24" Foreground="{ThemeResource SystemAccentColor}"
                                          Visibility="{Binding HasIcon, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
                                <Image Source="{Binding IconUrl}" Stretch="UniformToFill"
                                       Visibility="{Binding HasIcon, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            </Grid>
                        </Border>
                        
                        <!-- Info -->
                        <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="16,0">
                            <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" TextTrimming="CharacterEllipsis" FontSize="16"/>
                            <TextBlock Text="{Binding Url}" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextTrimming="CharacterEllipsis"/>
                        </StackPanel>
                        
                        <!-- Actions -->
                        <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="8">
                            <Button ToolTipService.ToolTip="Konfigüre Et" Click="BtnConfigure_Click" Tag="{Binding Url}" Style="{ThemeResource SubtleButtonStyle}">
                                <FontIcon Glyph="&#xE713;"/>
                            </Button>
                            
                            <Button ToolTipService.ToolTip="URL Kopyala" Click="BtnCopyUrl_Click" Tag="{Binding Url}" Style="{ThemeResource SubtleButtonStyle}">
                                <FontIcon Glyph="&#xE8C8;"/>
                            </Button>

                            <Button ToolTipService.ToolTip="Kaldır" Click="BtnRemove_Click" Tag="{Binding Url}" Style="{ThemeResource SubtleButtonStyle}">
                                <FontIcon Glyph="&#xE74D;" Foreground="Red"/>
                            </Button>
                        </StackPanel>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
        
        <InfoBar x:Name="StatusInfoBar" VerticalAlignment="Bottom" IsOpen="False"/>
    </Grid>
</Page>
