<Page
    x:Class="ModernIPTVPlayer.WatchlistPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:ModernIPTVPlayer"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ctl="using:ModernIPTVPlayer.Controls"
    mc:Ignorable="d"
    Background="Transparent">

    <Grid x:Name="RootLayout">
        <Grid.Resources>
            <Storyboard x:Name="ExpandSearchAnim">
                <DoubleAnimation Storyboard.TargetName="WatchlistSearchBox"
                                 Storyboard.TargetProperty="Width"
                                 EnableDependentAnimation="True"
                                 To="200" Duration="0:0:0.3">
                    <DoubleAnimation.EasingFunction>
                        <CubicEase EasingMode="EaseOut"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation Storyboard.TargetName="WatchlistSearchBox"
                                 Storyboard.TargetProperty="Opacity"
                                 To="1" Duration="0:0:0.2"/>
            </Storyboard>
            <Storyboard x:Name="CollapseSearchAnim">
                <DoubleAnimation Storyboard.TargetName="WatchlistSearchBox"
                                 Storyboard.TargetProperty="Width"
                                 EnableDependentAnimation="True"
                                 To="0" Duration="0:0:0.3">
                    <DoubleAnimation.EasingFunction>
                        <CubicEase EasingMode="EaseIn"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation Storyboard.TargetName="WatchlistSearchBox"
                                 Storyboard.TargetProperty="Opacity"
                                 To="0" Duration="0:0:0.2"/>
            </Storyboard>

            <!-- Refined AutoSuggestBox Style -->
            <Style x:Key="ModernSearchBoxStyle" TargetType="AutoSuggestBox">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="FontSize" Value="13"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
                <Setter Property="TextBoxStyle">
                    <Setter.Value>
                        <Style TargetType="TextBox">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="Padding" Value="4,4,8,4"/>
                            <Setter Property="PlaceholderForeground" Value="#66FFFFFF"/>
                        </Style>
                    </Setter.Value>
                </Setter>
            </Style>
        </Grid.Resources>

        <!-- Dynamic Backdrop -->
        <ctl:DynamicBackdrop x:Name="BackdropControl" />
        
        <!-- Vignette -->
        <Rectangle Fill="#20000000" IsHitTestVisible="False"/>

        <ScrollViewer x:Name="RootScroll" Padding="0" VerticalScrollBarVisibility="Auto">
            <StackPanel Spacing="20" Padding="0,40,0,60">
                <!-- Header Actions -->
                <Grid Padding="40,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel VerticalAlignment="Center" Spacing="4">
                        <TextBlock Text="İZLEME LİSTEM" FontSize="32" FontWeight="ExtraBold" CharacterSpacing="50">
                            <TextBlock.Foreground>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="White" Offset="0"/>
                                    <GradientStop Color="#CCFFFFFF" Offset="1"/>
                                </LinearGradientBrush>
                            </TextBlock.Foreground>
                        </TextBlock>
                        <TextBlock x:Name="WatchlistStatsText" Text="Yükleniyor..." FontSize="12" FontWeight="SemiBold" Opacity="0.6" Margin="4,0,0,0"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" Background="#15FFFFFF" Padding="4" CornerRadius="20" VerticalAlignment="Center" HorizontalAlignment="Right">
                        <!-- Animated Search -->
                        <StackPanel Orientation="Horizontal">
                            <Button x:Name="SearchTriggerButton" 
                                    Click="SearchTriggerButton_Click"
                                    Background="Transparent" 
                                    BorderThickness="0" 
                                    Padding="10,0"
                                    Height="32"
                                    CornerRadius="16">
                                <FontIcon Glyph="&#xE721;" FontSize="14" Opacity="0.7"/>
                            </Button>
                            
                            <AutoSuggestBox x:Name="WatchlistSearchBox" 
                                          PlaceholderText="Listende ara..." 
                                          Width="0" 
                                          Opacity="0"
                                          Style="{StaticResource ModernSearchBoxStyle}"
                                          TextChanged="WatchlistSearchBox_TextChanged"
                                          LostFocus="WatchlistSearchBox_LostFocus">
                                <AutoSuggestBox.Resources>
                                    <Thickness x:Key="AutoSuggestBoxTopButtonMargin">0</Thickness>
                                    <!-- Remove default backgrounds/borders in all states -->
                                    <SolidColorBrush x:Key="TextControlBackground" Color="Transparent"/>
                                    <SolidColorBrush x:Key="TextControlBackgroundPointerOver" Color="Transparent"/>
                                    <SolidColorBrush x:Key="TextControlBackgroundFocused" Color="Transparent"/>
                                    <SolidColorBrush x:Key="TextControlBorderBrush" Color="Transparent"/>
                                    <SolidColorBrush x:Key="TextControlBorderBrushPointerOver" Color="Transparent"/>
                                    <SolidColorBrush x:Key="TextControlBorderBrushFocused" Color="Transparent"/>
                                </AutoSuggestBox.Resources>
                            </AutoSuggestBox>
                        </StackPanel>

                        <!-- Search Divider -->
                        <Rectangle x:Name="SearchDivider" 
                                   Width="1" 
                                   Height="16" 
                                   Fill="White" 
                                   Opacity="0.3" 
                                   Margin="12,0" 
                                   VerticalAlignment="Center"/>

                        <!-- Filters -->
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <RadioButton x:Name="FilterAll" Content="Hepsi" IsChecked="True" Style="{StaticResource PillRadioButtonStyle}" Checked="Filter_Checked" Tag="all" MinWidth="60"/>
                            <RadioButton x:Name="FilterMovies" Content="Filmler" Style="{StaticResource PillRadioButtonStyle}" Checked="Filter_Checked" Tag="movie" MinWidth="60"/>
                            <RadioButton x:Name="FilterSeries" Content="Diziler" Style="{StaticResource PillRadioButtonStyle}" Checked="Filter_Checked" Tag="series" MinWidth="60"/>
                        </StackPanel>

                        <!-- Divider -->
                        <Rectangle Width="1" Height="20" Fill="#33FFFFFF" Margin="8,0"/>

                        <!-- Sort Button with Menu -->
                        <Button x:Name="SortButton" 
                                Background="Transparent" 
                                BorderThickness="0" 
                                CornerRadius="20"
                                Padding="12,0"
                                Height="32"
                                MinWidth="110">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE8CB;" FontSize="14" Opacity="0.7"/>
                                <TextBlock x:Name="SortButtonText" Text="Son Eklenenler" FontSize="13" VerticalAlignment="Center"/>
                                <FontIcon Glyph="&#xE70D;" FontSize="10" Opacity="0.5"/>
                            </StackPanel>
                            <Button.Flyout>
                                <MenuFlyout Placement="BottomEdgeAlignedRight">
                                    <MenuFlyout.MenuFlyoutPresenterStyle>
                                        <Style TargetType="MenuFlyoutPresenter">
                                            <Setter Property="MinWidth" Value="{Binding ElementName=SortButton, Path=ActualWidth}"/>
                                        </Style>
                                    </MenuFlyout.MenuFlyoutPresenterStyle>
                                    <MenuFlyoutItem Text="Son Eklenenler" Tag="recent" Click="SortItem_Click"/>
                                    <MenuFlyoutItem Text="A'dan Z'ye" Tag="az" Click="SortItem_Click"/>
                                    <MenuFlyoutItem Text="Puan (Yüksek)" Tag="rating" Click="SortItem_Click"/>
                                </MenuFlyout>
                            </Button.Flyout>
                        </Button>
                    </StackPanel>
                </Grid>

                <!-- Content Sections -->
                <StackPanel x:Name="SectionsPanel" Spacing="30">
                    <!-- Continue Watching -->
                    <StackPanel x:Name="ContinueWatchingSection" Spacing="12" Visibility="Collapsed">
                        <TextBlock Text="İZLEMEYE DEVAM ET" FontSize="13" FontWeight="Bold" Margin="44,0,0,0" Opacity="0.5" CharacterSpacing="100"/>
                        <ctl:UnifiedMediaGrid x:Name="ContinueWatchingGrid" 
                                              ShowTitles="True"
                                              ItemClicked="WatchlistGrid_ItemClicked"
                                              PlayAction="WatchlistGrid_PlayAction"
                                              DetailsAction="WatchlistGrid_DetailsAction"
                                              AddListAction="WatchlistGrid_AddListAction"
                                              ColorExtracted="WatchlistGrid_ColorExtracted"
                                              HoverEnded="WatchlistGrid_HoverEnded"/>
                    </StackPanel>

                    <!-- Main Watchlist / Watch Later -->
                    <StackPanel x:Name="MainWatchlistSection" Spacing="12">
                        <TextBlock x:Name="MainSectionTitle" Text="İZLEME LİSTESİ" FontSize="13" FontWeight="Bold" Margin="44,0,0,0" Opacity="0.5" CharacterSpacing="100"/>
                        <ctl:UnifiedMediaGrid x:Name="WatchlistGrid" 
                                              ShowTitles="True"
                                              ItemClicked="WatchlistGrid_ItemClicked"
                                              PlayAction="WatchlistGrid_PlayAction"
                                              DetailsAction="WatchlistGrid_DetailsAction"
                                              AddListAction="WatchlistGrid_AddListAction"
                                              ColorExtracted="WatchlistGrid_ColorExtracted"
                                              HoverEnded="WatchlistGrid_HoverEnded"/>
                    </StackPanel>
                </StackPanel>

                <!-- Empty State -->
                <StackPanel x:Name="EmptyStatePanel" VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="30" Visibility="Collapsed" Margin="0,100,0,0">
                    <StackPanel Spacing="10" HorizontalAlignment="Center">
                        <FontIcon Glyph="&#xEB05;" FontSize="60" Foreground="White" Opacity="0.2"/>
                        <TextBlock Text="İzleme listeniz şu an boş." FontSize="20" FontWeight="SemiBold" HorizontalAlignment="Center" Opacity="0.5"/>
                        <Button Content="İçerikleri Keşfet" Click="BrowseButton_Click" HorizontalAlignment="Center" Margin="0,10,0,0" Style="{StaticResource AccentButtonStyle}" Padding="20,8" CornerRadius="20"/>
                    </StackPanel>

                    <!-- Recommendations Section -->
                    <StackPanel Spacing="20" Margin="0,40,0,0">
                        <TextBlock Text="Size Özel Öneriler" FontSize="24" FontWeight="Bold" CharacterSpacing="20" HorizontalAlignment="Center"/>
                        <ctl:UnifiedMediaGrid x:Name="RecommendationsGrid" 
                                              ShowTitles="True"
                                              ItemClicked="WatchlistGrid_ItemClicked"
                                              Height="350"/>
                    </StackPanel>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
