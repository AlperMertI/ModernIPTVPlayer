<UserControl
    x:Class="ModernIPTVPlayer.Controls.SpotlightSearchControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:ModernIPTVPlayer.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    d:DesignHeight="600"
    d:DesignWidth="800"
    Width="700"
    Height="500"
    HorizontalAlignment="Center"
    VerticalAlignment="Center"
    RenderTransformOrigin="0.5,0.5">

    <UserControl.Resources>
        <Storyboard x:Name="OpenAnimation">
            <DoubleAnimation Storyboard.TargetName="RootBorder" Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.25">
                <DoubleAnimation.EasingFunction>
                    <ExponentialEase EasingMode="EaseOut" Exponent="4"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="RootScale" Storyboard.TargetProperty="ScaleX" From="0.95" To="1" Duration="0:0:0.25">
                <DoubleAnimation.EasingFunction>
                    <ExponentialEase EasingMode="EaseOut" Exponent="4"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="RootScale" Storyboard.TargetProperty="ScaleY" From="0.95" To="1" Duration="0:0:0.25">
                <DoubleAnimation.EasingFunction>
                    <ExponentialEase EasingMode="EaseOut" Exponent="4"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <Storyboard x:Name="CloseAnimation">
            <DoubleAnimation Storyboard.TargetName="RootBorder" Storyboard.TargetProperty="Opacity" From="1" To="0" Duration="0:0:0.15">
                <DoubleAnimation.EasingFunction>
                    <ExponentialEase EasingMode="EaseIn" Exponent="4"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="RootScale" Storyboard.TargetProperty="ScaleX" From="1" To="0.95" Duration="0:0:0.15">
                <DoubleAnimation.EasingFunction>
                    <ExponentialEase EasingMode="EaseIn" Exponent="4"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation Storyboard.TargetName="RootScale" Storyboard.TargetProperty="ScaleY" From="1" To="0.95" Duration="0:0:0.15">
                <DoubleAnimation.EasingFunction>
                    <ExponentialEase EasingMode="EaseIn" Exponent="4"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
        
        <!-- Result Item Style -->
        <Style x:Key="ResultItemStyle" TargetType="ListViewItem">
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="0,2"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <Grid x:Name="Root" Background="Transparent" CornerRadius="6" Padding="{TemplateBinding Padding}">
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="CommonStates">
                                    <VisualState x:Name="Normal"/>
                                    <VisualState x:Name="PointerOver">
                                        <Storyboard>
                                            <ColorAnimation Storyboard.TargetName="Root" Storyboard.TargetProperty="(Grid.Background).(SolidColorBrush.Color)" To="#1FFFFFFF" Duration="0:0:0.1"/>
                                        </Storyboard>
                                    </VisualState>
                                    <VisualState x:Name="Selected">
                                        <Storyboard>
                                            <ColorAnimation Storyboard.TargetName="Root" Storyboard.TargetProperty="(Grid.Background).(SolidColorBrush.Color)" To="#33FFFFFF" Duration="0:0:0.1"/>
                                        </Storyboard>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>
                            <ContentPresenter/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <UserControl.RenderTransform>
        <ScaleTransform x:Name="RootScale" ScaleX="0.95" ScaleY="0.95"/>
    </UserControl.RenderTransform>

    <Border x:Name="RootBorder" 
            Background="#E6101010" 
            BorderBrush="#33FFFFFF" 
            BorderThickness="1" 
            CornerRadius="12"
            Padding="0"
            Opacity="0"
            VerticalAlignment="Top"
            Margin="0,100,0,0">
        <Border.Shadow>
            <ThemeShadow />
        </Border.Shadow>
        
        <Grid>
            <Grid.Resources>
                <Style x:Key="CleanTextBoxStyle" TargetType="TextBox">
                    <Setter Property="BorderThickness" Value="0"/>
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="FocusVisualPrimaryBrush" Value="Transparent"/>
                    <Setter Property="FocusVisualSecondaryBrush" Value="Transparent"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="TextBox">
                                <Grid>
                                    <ScrollViewer x:Name="ContentElement" BorderThickness="0" IsTabStop="False" Padding="{TemplateBinding Padding}" VerticalAlignment="Center"/>
                                    <TextBlock x:Name="PlaceholderTextContentPresenter" Text="{TemplateBinding PlaceholderText}" Foreground="{TemplateBinding PlaceholderForeground}" Padding="{TemplateBinding Padding}" IsHitTestVisible="False" Visibility="Collapsed" VerticalAlignment="Center"/>
                                </Grid>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </Grid.Resources>

            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Search Box -->
                <RowDefinition Height="*"/> <!-- Results/Shimmer (Dynamic) -->
                <RowDefinition Height="Auto"/> <!-- Footer -->
            </Grid.RowDefinitions>

            <!-- 1. Search Box -->
            <Grid Height="64" VerticalAlignment="Top" BorderBrush="#1FFFFFFF" BorderThickness="0,0,0,1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="64"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <FontIcon Glyph="&#xE721;" FontSize="20" Foreground="#AAFFFFFF" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                
                <TextBox x:Name="SearchBox" Grid.Column="1"
                         PlaceholderText="Film, Dizi veya Kişi Ara..." 
                         Style="{StaticResource CleanTextBoxStyle}"
                         Foreground="White"
                         FontSize="20"
                         FontWeight="Normal"
                         VerticalAlignment="Stretch"
                         VerticalContentAlignment="Center"
                         Padding="0,0,16,0"
                         TextChanged="SearchBox_TextChanged"
                         KeyDown="SearchBox_KeyDown"/>
                
                <!-- Loading Spinner (Fallback/Subtle) -->
                <ProgressRing x:Name="SearchSpinner" Grid.Column="2" 
                              Width="24" Height="24" Margin="0,0,24,0" 
                              IsActive="False" Visibility="Collapsed"/>
            </Grid>

            <!-- 2. Results Area -->
            <Grid Grid.Row="1">
                <!-- A. Results List -->
                <ListView x:Name="ResultsList" 
                          SelectionMode="Single"
                          ItemContainerStyle="{StaticResource ResultItemStyle}"
                          IsItemClickEnabled="True"
                          ItemClick="ResultsList_ItemClick"
                          Padding="12"
                          Visibility="Collapsed"
                          ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid Height="64">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="42"/> <!-- Poster -->
                                    <ColumnDefinition Width="*"/>  <!-- Details -->
                                    <ColumnDefinition Width="Auto"/> <!-- Badge -->
                                </Grid.ColumnDefinitions>
                                
                                <Border CornerRadius="4" Width="42" Height="60" VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <Border.Background>
                                        <ImageBrush ImageSource="{Binding PosterBitmap}" Stretch="UniformToFill"/>
                                    </Border.Background>
                                </Border>
                                
                                <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="12,0">
                                    <TextBlock Text="{Binding Title}" Foreground="White" FontSize="16" FontWeight="SemiBold" TextTrimming="CharacterEllipsis"/>
                                    <StackPanel Orientation="Horizontal" Spacing="6" Opacity="0.7">
                                        <TextBlock Text="{Binding Year}" Foreground="#CCCCCC" FontSize="13"/>
                                        <TextBlock Text="•" Foreground="#66FFFFFF"/>
                                        <FontIcon Glyph="&#xE735;" FontSize="11" Foreground="#FFD700" VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding Rating}" Foreground="#FFD700" FontSize="13"/>
                                    </StackPanel>
                                </StackPanel>
                                
                                <Border Grid.Column="2" Background="#22FFFFFF" CornerRadius="4" Padding="8,2" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Type}" Foreground="#AAFFFFFF" FontSize="11" FontWeight="Bold" CharacterSpacing="50"/>
                                </Border>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
                
                <!-- B. Shimmer / Skeleton (Loading) -->
                <StackPanel x:Name="ShimmerPanel" Visibility="Collapsed" Padding="12" Spacing="8">
                    <local:ShimmerRow/>
                    <local:ShimmerRow/>
                    <local:ShimmerRow/>
                    <local:ShimmerRow/>
                </StackPanel>
                
                <!-- C. Empty State -->
                <StackPanel x:Name="EmptyStatePanel" Visibility="Collapsed" HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12">
                    <FontIcon Glyph="&#xE773;" FontSize="48" Foreground="#33FFFFFF"/>
                    <TextBlock Text="Sonuç Bulunamadı" Foreground="#66FFFFFF" FontSize="16"/>
                </StackPanel>
            </Grid>
            
            <!-- 3. Footer -->
            <Button x:Name="SeeAllButton" Grid.Row="2" 
                    HorizontalAlignment="Stretch" HorizontalContentAlignment="Left"
                    Background="Transparent" BorderThickness="0,1,0,0" BorderBrush="#1FFFFFFF"
                    Padding="24,12" Height="48"
                    Click="SeeAllButton_Click"
                    Visibility="Collapsed">
                <StackPanel Orientation="Horizontal" Spacing="12">
                     <FontIcon Glyph="&#xE721;" FontSize="14" Foreground="{ThemeResource SystemAccentColor}"/>
                     <TextBlock x:Name="SeeAllText" Text="Tüm sonuçları gör..." Foreground="{ThemeResource SystemAccentColor}" FontWeight="SemiBold"/>
                </StackPanel>
            </Button>
        </Grid>
    </Border>
</UserControl>
