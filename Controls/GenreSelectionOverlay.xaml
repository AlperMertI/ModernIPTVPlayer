<UserControl
    x:Class="ModernIPTVPlayer.Controls.GenreSelectionOverlay"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d" d:DesignHeight="800" d:DesignWidth="1200">

    <UserControl.Resources>
        <ThemeShadow x:Key="SharedShadow"/>
    </UserControl.Resources>

    <Grid x:Name="RootGrid" Visibility="Collapsed" Opacity="0">
        <Grid.Background>
            <AcrylicBrush TintColor="#0F131C" TintOpacity="0.85" FallbackColor="#0F131C"/>
        </Grid.Background>
        
        <Grid.Resources>
            <Storyboard x:Name="ShowStoryboard">
                <DoubleAnimation Storyboard.TargetName="RootGrid" Storyboard.TargetProperty="Opacity" To="1" Duration="0:0:0.25">
                    <DoubleAnimation.EasingFunction>
                        <CircleEase EasingMode="EaseOut"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation Storyboard.TargetName="ContentScale" Storyboard.TargetProperty="ScaleX" From="0.95" To="1" Duration="0:0:0.3">
                        <DoubleAnimation.EasingFunction>
                        <BackEase EasingMode="EaseOut" Amplitude="0.3"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation Storyboard.TargetName="ContentScale" Storyboard.TargetProperty="ScaleY" From="0.95" To="1" Duration="0:0:0.3">
                        <DoubleAnimation.EasingFunction>
                        <BackEase EasingMode="EaseOut" Amplitude="0.3"/>
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
            </Storyboard>
            <Storyboard x:Name="HideStoryboard">
                <DoubleAnimation Storyboard.TargetName="RootGrid" Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.2"/>
            </Storyboard>
        </Grid.Resources>

        <Grid HorizontalAlignment="Center" VerticalAlignment="Center" MaxWidth="1200" MaxHeight="800" Margin="60,40" RenderTransformOrigin="0.5,0.5">
            <Grid.RenderTransform>
                <ScaleTransform x:Name="ContentScale" ScaleX="1" ScaleY="1"/>
            </Grid.RenderTransform>
            
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1*"/>
                <ColumnDefinition Width="3*"/>
            </Grid.ColumnDefinitions>

            <!-- SIDEBAR: Addon Selection -->
            <Grid Grid.Column="0" Background="#1AFFFFFF" CornerRadius="20,0,0,20" Padding="12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Text="Eklentiler" FontSize="18" FontWeight="SemiBold" Margin="8,8,8,16" Foreground="#BFFFFFFF"/>

                <ListView x:Name="AddonListView" Grid.Row="1" 
                          SelectionMode="Single"
                          SelectionChanged="AddonListView_SelectionChanged"
                          Padding="0">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="0,4" Height="48">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="40"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Ellipse Width="32" Height="32">
                                    <Ellipse.Fill>
                                        <ImageBrush ImageSource="{Binding Logo}" Stretch="UniformToFill"/>
                                    </Ellipse.Fill>
                                </Ellipse>
                                <TextBlock Grid.Column="1" Text="{Binding Name}" 
                                           VerticalAlignment="Center" Margin="12,0,0,0"
                                           FontSize="14" FontWeight="SemiBold" 
                                           TextTrimming="CharacterEllipsis"/>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Margin" Value="0,2"/>
                            <Setter Property="CornerRadius" Value="10"/>
                        </Style>
                    </ListView.ItemContainerStyle>
                </ListView>
            </Grid>

            <!-- CONTENT: Categories Pivot -->
            <Grid Grid.Column="1" Background="#0DFFFFFF" CornerRadius="0,20,20,0" Padding="20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock x:Name="SelectedAddonTitle" Text="Kategoriler" FontSize="24" FontWeight="Bold" Margin="0,0,0,10"/>

                <Pivot x:Name="FilterPivot" Grid.Row="1">
                    <Pivot.HeaderTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Name}" FontSize="16" FontWeight="SemiBold"/>
                        </DataTemplate>
                    </Pivot.HeaderTemplate>

                    <Pivot.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="0,12,0,0">
                                <GridView SelectionMode="None" 
                                          IsItemClickEnabled="True" 
                                          ItemsSource="{Binding Options}"
                                          ItemClick="FilterGrid_ItemClick">
                                    <GridView.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <ItemsWrapGrid Orientation="Horizontal"/>
                                        </ItemsPanelTemplate>
                                    </GridView.ItemsPanel>
                                    <GridView.ItemTemplate>
                                        <DataTemplate>
                                            <Border Width="160" Height="44" CornerRadius="12" 
                                                    BorderBrush="#22FFFFFF" BorderThickness="1" 
                                                    Background="#1AFFFFFF">
                                                <TextBlock Text="{Binding}" VerticalAlignment="Center" 
                                                           HorizontalAlignment="Center" FontSize="14" 
                                                           FontWeight="SemiBold" Foreground="White" 
                                                           TextTrimming="CharacterEllipsis"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridView.ItemTemplate>
                                </GridView>
                            </Grid>
                        </DataTemplate>
                    </Pivot.ItemTemplate>
                </Pivot>
            </Grid>
            
            <!-- Close Button (Absolute Top Right) -->
            <Button HorizontalAlignment="Right" VerticalAlignment="Top" Grid.Column="1" Margin="0,-16,-16,0"
                    Click="CloseButton_Click" Background="#33000000" CornerRadius="20" Width="40" Height="40" Padding="0">
                <FontIcon Glyph="&#xE711;" FontSize="16" Foreground="White"/>
            </Button>
        </Grid>

        <!-- Tap outside to close -->
        <Grid Background="Transparent" Canvas.ZIndex="-1" Tapped="Background_Tapped"/>
    </Grid>
</UserControl>
